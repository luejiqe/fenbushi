# Animals90 åŠ¨ç‰©è¯†åˆ«ç³»ç»Ÿ

åŸºäºResNet18çš„Animals90æ•°æ®é›†åŠ¨ç‰©è¯†åˆ«ç³»ç»Ÿï¼Œä½¿ç”¨PyTorchå®ç°ã€‚

## é¡¹ç›®ç»“æ„

```
fenbushi/
â”œâ”€â”€ src/                      # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ dataset.py           # æ•°æ®åŠ è½½å’Œé¢„å¤„ç†
â”‚   â”œâ”€â”€ model.py             # ResNet18æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ train.py             # è®­ç»ƒè„šæœ¬
â”‚   â”œâ”€â”€ predict.py           # æ¨ç†è„šæœ¬
â”‚   â”œâ”€â”€ evaluate.py          # è¯„ä¼°è„šæœ¬
â”‚   â””â”€â”€ utils.py             # å·¥å…·å‡½æ•°
â”œâ”€â”€ data/                     # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ train/               # è®­ç»ƒé›†
â”‚   â”œâ”€â”€ val/                 # éªŒè¯é›†
â”‚   â””â”€â”€ test/                # æµ‹è¯•é›†
â”œâ”€â”€ checkpoints/             # æ¨¡å‹æ£€æŸ¥ç‚¹
â”œâ”€â”€ logs/                    # è®­ç»ƒæ—¥å¿—
â”œâ”€â”€ models/                  # ä¿å­˜çš„æ¨¡å‹
â”œâ”€â”€ requirements.txt         # ä¾èµ–åŒ…
â””â”€â”€ README.md               # é¡¹ç›®è¯´æ˜
```

## åŠŸèƒ½ç‰¹æ€§

- âœ… åŸºäºé¢„è®­ç»ƒResNet18çš„è¿ç§»å­¦ä¹ 
- âœ… æ”¯æŒ90ç§åŠ¨ç‰©åˆ†ç±»
- âœ… å®Œæ•´çš„æ•°æ®å¢å¼ºç­–ç•¥
- âœ… è®­ç»ƒè¿‡ç¨‹å¯è§†åŒ–
- âœ… å­¦ä¹ ç‡è‡ªåŠ¨è°ƒæ•´
- âœ… æ¨¡å‹è¯„ä¼°å’Œæ€§èƒ½åˆ†æ
- âœ… å•å¼ /æ‰¹é‡å›¾ç‰‡æ¨ç†
- âœ… æ··æ·†çŸ©é˜µå’Œåˆ†ç±»æŠ¥å‘Šç”Ÿæˆ
- ğŸš€ **DeepSpeed ZeRO-2åŠ é€Ÿè®­ç»ƒ**ï¼ˆæ–°å¢ï¼‰
- ğŸš€ **æ”¯æŒæ‘©å°”çº¿ç¨‹GPU (MUSA)**ï¼ˆæ–°å¢ï¼‰

## ç¯å¢ƒè¦æ±‚

- Python 3.8+
- CUDA 11.0+ (å¯é€‰ï¼Œç”¨äºGPUåŠ é€Ÿ)

## å®‰è£…

1. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd fenbushi
```

2. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

## æ•°æ®å‡†å¤‡

å°†Animals90æ•°æ®é›†æŒ‰ä»¥ä¸‹ç»“æ„ç»„ç»‡ï¼š

```
data/
â”œâ”€â”€ train/
â”‚   â”œâ”€â”€ class1/
â”‚   â”‚   â”œâ”€â”€ img1.jpg
â”‚   â”‚   â””â”€â”€ img2.jpg
â”‚   â”œâ”€â”€ class2/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ val/
â”‚   â”œâ”€â”€ class1/
â”‚   â”œâ”€â”€ class2/
â”‚   â””â”€â”€ ...
â””â”€â”€ test/
    â”œâ”€â”€ class1/
    â”œâ”€â”€ class2/
    â””â”€â”€ ...
```

æ¯ä¸ªç±»åˆ«å¯¹åº”ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹åå³ä¸ºç±»åˆ«åã€‚

## ä½¿ç”¨æ–¹æ³•

### 1. è®­ç»ƒæ¨¡å‹

#### æ–¹å¼A: æ ‡å‡†è®­ç»ƒ

åŸºæœ¬è®­ç»ƒå‘½ä»¤ï¼š

```bash
python src/train.py --train_dir data/train --val_dir data/val
```

é«˜çº§è®­ç»ƒé€‰é¡¹ï¼š

```bash
python src/train.py \
    --train_dir data/train \
    --val_dir data/val \
    --epochs 50 \
    --batch_size 32 \
    --learning_rate 0.001 \
    --img_size 224 \
    --pretrained \
    --scheduler plateau \
    --checkpoint_dir checkpoints \
    --log_dir logs
```

å‚æ•°è¯´æ˜ï¼š
- `--train_dir`: è®­ç»ƒé›†ç›®å½•
- `--val_dir`: éªŒè¯é›†ç›®å½•
- `--epochs`: è®­ç»ƒè½®æ•° (é»˜è®¤: 50)
- `--batch_size`: æ‰¹æ¬¡å¤§å° (é»˜è®¤: 32)
- `--learning_rate`: åˆå§‹å­¦ä¹ ç‡ (é»˜è®¤: 0.001)
- `--img_size`: è¾“å…¥å›¾ç‰‡å¤§å° (é»˜è®¤: 224)
- `--pretrained`: ä½¿ç”¨ImageNeté¢„è®­ç»ƒæƒé‡
- `--freeze_backbone`: å†»ç»“ä¸»å¹²ç½‘ç»œ
- `--scheduler`: å­¦ä¹ ç‡è°ƒåº¦å™¨ (plateau/cosine/none)
- `--weight_decay`: æƒé‡è¡°å‡ (é»˜è®¤: 1e-4)
- `--num_workers`: æ•°æ®åŠ è½½çº¿ç¨‹æ•° (é»˜è®¤: 4)

#### æ–¹å¼B: DeepSpeedåŠ é€Ÿè®­ç»ƒï¼ˆæ¨èï¼‰

ä½¿ç”¨DeepSpeed ZeRO-2å¯ä»¥å‡å°‘æ˜¾å­˜å ç”¨å¹¶åŠ é€Ÿè®­ç»ƒï¼š

```bash
# åŸºç¡€DeepSpeedè®­ç»ƒ
python launch_deepspeed.py

# é«˜æ€§èƒ½è®­ç»ƒï¼ˆæ¨èï¼‰
python launch_deepspeed.py \
    --batch_size 32 \
    --fp16 \
    --offload_optimizer

# å¤šGPUè®­ç»ƒ
python launch_deepspeed.py \
    --num_gpus 2 \
    --fp16
```

**DeepSpeedä¼˜åŠ¿**:
- å‡å°‘50-70%æ˜¾å­˜å ç”¨
- FP16è®­ç»ƒåŠ é€Ÿ1.5å€
- æ”¯æŒæ›´å¤§batch size
- å¤šGPUå¹¶è¡Œè®­ç»ƒ

è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹ [DEEPSPEED_GUIDE.md](DEEPSPEED_GUIDE.md)

### 2. æ¨¡å‹æ¨ç†

å•å¼ å›¾ç‰‡é¢„æµ‹ï¼š

```bash
python src/predict.py \
    --checkpoint checkpoints/checkpoint_best.pth \
    --image path/to/image.jpg \
    --top_k 5
```

æ‰¹é‡é¢„æµ‹ï¼š

```bash
python src/predict.py \
    --checkpoint checkpoints/checkpoint_best.pth \
    --image_dir path/to/images/ \
    --top_k 5 \
    --output predictions.json
```

### 3. æ¨¡å‹è¯„ä¼°

```bash
python src/evaluate.py \
    --checkpoint checkpoints/checkpoint_best.pth \
    --test_dir data/test \
    --batch_size 32 \
    --output_dir evaluation_results
```

è¯„ä¼°ç»“æœåŒ…æ‹¬ï¼š
- æ•´ä½“å‡†ç¡®ç‡
- æ¯ä¸ªç±»åˆ«çš„precisionã€recallã€f1-score
- æ··æ·†çŸ©é˜µå¯è§†åŒ–
- åˆ†ç±»æŠ¥å‘ŠJSONæ–‡ä»¶

### 4. å¯è§†åŒ–è®­ç»ƒå†å²

```bash
python src/utils.py \
    --history logs/training_history.json \
    --output training_curves.png
```

## æ¨¡å‹æ¶æ„

æœ¬é¡¹ç›®ä½¿ç”¨ResNet18ä½œä¸ºéª¨å¹²ç½‘ç»œï¼Œä¸»è¦ç‰¹ç‚¹ï¼š

1. **é¢„è®­ç»ƒ**: ä½¿ç”¨ImageNeté¢„è®­ç»ƒæƒé‡è¿›è¡Œè¿ç§»å­¦ä¹ 
2. **åˆ†ç±»å¤´**: è‡ªå®šä¹‰å…¨è¿æ¥å±‚
   - Dropout(0.5) â†’ Linear(512) â†’ ReLU â†’ Dropout(0.3) â†’ Linear(90)
3. **å‚æ•°é‡**: çº¦11Må‚æ•°

## æ•°æ®å¢å¼ºç­–ç•¥

è®­ç»ƒé›†å¢å¼ºï¼š
- éšæœºè£å‰ª (224x224)
- éšæœºæ°´å¹³ç¿»è½¬ (p=0.5)
- éšæœºæ—‹è½¬ (Â±15Â°)
- é¢œè‰²æŠ–åŠ¨ (äº®åº¦ã€å¯¹æ¯”åº¦ã€é¥±å’Œåº¦ã€è‰²è°ƒ)
- æ ‡å‡†åŒ– (ImageNetå‡å€¼å’Œæ ‡å‡†å·®)

éªŒè¯/æµ‹è¯•é›†ï¼š
- ç›´æ¥resizeåˆ°224x224
- æ ‡å‡†åŒ–

## è®­ç»ƒæŠ€å·§

1. **å­¦ä¹ ç‡è°ƒåº¦**:
   - ReduceLROnPlateau: å½“éªŒè¯æŸå¤±åœæ­¢ä¸‹é™æ—¶é™ä½å­¦ä¹ ç‡
   - CosineAnnealingLR: ä½™å¼¦é€€ç«å­¦ä¹ ç‡

2. **æ­£åˆ™åŒ–**:
   - Dropoutå±‚é˜²æ­¢è¿‡æ‹Ÿåˆ
   - æƒé‡è¡°å‡ (L2æ­£åˆ™åŒ–)

3. **æ—©åœç­–ç•¥**:
   - è‡ªåŠ¨ä¿å­˜æœ€ä½³éªŒè¯å‡†ç¡®ç‡çš„æ¨¡å‹

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å¢åŠ è®­ç»ƒæ•°æ®**: ä½¿ç”¨æ•°æ®å¢å¼ºæˆ–æ”¶é›†æ›´å¤šæ ·æœ¬
2. **è°ƒæ•´è¶…å‚æ•°**: å­¦ä¹ ç‡ã€æ‰¹æ¬¡å¤§å°ã€æƒé‡è¡°å‡ç­‰
3. **æ›´æ·±çš„ç½‘ç»œ**: å°è¯•ResNet50ã€ResNet101
4. **é›†æˆå­¦ä¹ **: è®­ç»ƒå¤šä¸ªæ¨¡å‹è¿›è¡ŒæŠ•ç¥¨
5. **æ··åˆç²¾åº¦è®­ç»ƒ**: ä½¿ç”¨AMPåŠ é€Ÿè®­ç»ƒ

## å¸¸è§é—®é¢˜

### Q: è®­ç»ƒæ—¶æ˜¾å­˜ä¸è¶³ï¼Ÿ
A: å‡å°batch_sizeæˆ–img_sizeï¼Œä¾‹å¦‚ï¼š
```bash
python src/train.py --batch_size 16 --img_size 128
```

### Q: å¦‚ä½•ä½¿ç”¨CPUè®­ç»ƒï¼Ÿ
A: ç¨‹åºä¼šè‡ªåŠ¨æ£€æµ‹ï¼Œå¦‚æœæ²¡æœ‰GPUä¼šä½¿ç”¨CPU

### Q: å¦‚ä½•ç»§ç»­è®­ç»ƒï¼Ÿ
A: å¯ä»¥åŠ è½½æ£€æŸ¥ç‚¹åç»§ç»­è®­ç»ƒï¼ˆéœ€è¦ä¿®æ”¹ä»£ç æ·»åŠ resumeåŠŸèƒ½ï¼‰

### Q: å¦‚ä½•å†»ç»“ä¸»å¹²ç½‘ç»œï¼Ÿ
A: æ·»åŠ  `--freeze_backbone` å‚æ•°ï¼Œåªè®­ç»ƒåˆ†ç±»å¤´

## ç¤ºä¾‹è¾“å‡º

è®­ç»ƒè¿‡ç¨‹ï¼š
```
Epoch 1/50:
  Train Loss: 3.4521 | Train Acc: 12.34%
  Val Loss: 3.1234 | Val Acc: 15.67%
  Learning Rate: 0.001000
  Best Val Acc: 15.67% (Epoch 1)
```

é¢„æµ‹ç»“æœï¼š
```
Top-5 Predictions:
  1. cat: 95.32%
  2. dog: 2.15%
  3. tiger: 1.23%
  4. lion: 0.89%
  5. leopard: 0.41%
```

## é¡¹ç›®è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## è®¸å¯è¯

MIT License

## ä½œè€…

Animals90 Recognition System

## æ›´æ–°æ—¥å¿—

- v1.0.0 (2025-12-28): åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
  - å®ç°åŸºç¡€è®­ç»ƒã€è¯„ä¼°ã€æ¨ç†åŠŸèƒ½
  - æ”¯æŒResNet18æ¨¡å‹
  - å®Œæ•´çš„æ•°æ®å¢å¼ºå’Œå¯è§†åŒ–
